---
templateKey: blog-post
title: 缓存雪崩、缓存穿透、缓存更新
date: 2019-04-10T08:02:23.447Z
description: '原链接：https://zhuanlan.zhihu.com/p/59945689'
tags:
  - 后端技术
  - 缓存
  - 技术笔记
---
<div id="centered"><table data-level="3" id="kC2z2PMWd7b" class="whole-row root"><tbody><tr class="outline-row level-3"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 9px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">缓存雪崩、缓存穿透、缓存更新</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="4" id="hjHxTBttPOM" class="whole-row"><tbody><tr class="outline-row level-4"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 25px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">缓存作用</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="fcl8zS5MuCm" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">性能（内存）</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="je84FuEITjP" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">！并发 - 缓存分担了部分请求，支持更高并发</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="4" id="gG_LQRAFuk5" class="whole-row"><tbody><tr class="outline-row level-4"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 25px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">缓存过期时间</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="4" id="bAMFDAk5J6t" class="whole-row"><tbody><tr class="outline-row level-4"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 25px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">删除策略</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="b_sEdJ6PA0J" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">惰性删除</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="iJ6aOT7xwyd" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">定期删除</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="4" id="f8n4e8oiyfe" class="whole-row"><tbody><tr class="outline-row level-4"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 25px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">缓存雪崩</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="nWssCgY6x83" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space"><span> </span>请求全打到DB。ex. 1. Redis 挂了；2. 设置的过期时间相同，某段时间缓存失效。</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="c_kCZ6PRY_5" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">方法</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="pp6Owx38v6U" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">事发中：本地缓存（ehcache）+限流（hystrix）</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="oLAWW0MD8ld" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">过期时间随机值</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="g3Upa4ICyTG" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">事发后：redis 持久化，重启后从硬盘加载数据，恢复</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="lWJdEfI1BvN" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">事发前：Redis 高可用</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="4" id="j-2tflHi4KN" class="whole-row"><tbody><tr class="outline-row level-4"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 25px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">缓存穿透</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="lfgli_0LCfb" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">查询一个不存在的数据（永远无法命中缓存，且查询DB也返回 null）</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="fsKJ5DSvrPf" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">风险 - 拖垮DB</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="hg3cYQVuI9g" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">方法：</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="oLNvP5gMDzG" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">2. 也将 null 置到缓存，一般设置一个较短的过期时间</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="fa-F-DMOAQV" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">1. 本质上是参数不合法，布隆过滤器或者压缩Filter提前拦截</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="4" id="jsJOIOQhnZ1" class="whole-row"><tbody><tr class="outline-row level-4"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 25px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">缓存与数据库双写一致</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="bZX--rRF7KH" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">更新导致</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="pqsleGsf5Qs" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">最终一致：理论上设置缓存过期时间</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="lpZXb5RsQ0J" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">方案</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="p2YJdT1MMU6" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">1. 先操作DB，再操作缓存</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="cy87r5AoM0E" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">2. 先操作缓存，再操作DB</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="j7z_leco4sS" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">确保：分布式事务</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="lxYSfYudQvi" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">操作缓存方案：1. 更新 2. 删除。一般选择删除缓存策略。原因：简单</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="5" id="cShSslDjycW" class="whole-row"><tbody><tr class="outline-row level-5"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 41px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">具体分析</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="m2YxpRj3tIt" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">先更新DB，再删除缓存</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="7" id="oCIgsAMn1pA" class="whole-row note-expanded"><tbody><tr class="outline-row level-7"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 73px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 4px; padding-top: 4px; "><div class="force-wrap white-space">高并发场景</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="7" id="noCIgsAMn1pA" class="whole-note"><tbody><tr class="note-row level-7"><td><div class="note-outline-column-div force-wrap fill-cell"><table class="note-table"><tbody><tr><td style="width: 73px;" class="note-bg "> </td><td class="note-bg " style="width: 15px;"> </td><td class="note-bg label empty" style=" color: rgba(0,0,0,0); width: 1px; "></td><td class="note" style="padding-bottom: 5px; "><div class="force-wrap white-space">1. 缓存刚好失效</div><div class="force-wrap white-space">2. 线程A查询数据库，得一个旧值</div><div class="force-wrap white-space">3. 线程B将新值写入数据库</div><div class="force-wrap white-space">4. 线程B删除缓存</div><div class="force-wrap white-space">5. 线程A将查到的旧值写入缓存</div></td></tr></tbody></table></div></td></tr></tbody></table><table data-level="8" id="in7LMHGV3tO" class="whole-row note-expanded"><tbody><tr class="outline-row level-8"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 89px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 4px; padding-top: 4px; "><div class="force-wrap white-space">策略 - 设计模式 Cache Aside Pattern</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="8" id="nin7LMHGV3tO" class="whole-note"><tbody><tr class="note-row level-8"><td><div class="note-outline-column-div force-wrap fill-cell"><table class="note-table"><tbody><tr><td style="width: 89px;" class="note-bg "> </td><td class="note-bg " style="width: 15px;"> </td><td class="note-bg label empty" style=" color: rgba(0,0,0,0); width: 1px; "></td><td class="note" style="padding-bottom: 5px; "><div class="force-wrap white-space">扩展链接：<a href="https://coolshell.cn/articles/17416.html" target="_blank">https://coolshell.cn/articles/17416.html</a></div></td></tr></tbody></table></div></td></tr></tbody></table><table data-level="9" id="gXbbylNcTfu" class="whole-row"><tbody><tr class="outline-row level-9"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 105px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">2. 下一个读操作，消费删除的key的消息队列，删除缓存。再拉 DB 数据到缓存。</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="9" id="lENLpdEHtZs" class="whole-row"><tbody><tr class="outline-row level-9"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 105px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">1. 即不在更新DB立即删除缓存，而是把待删除的 key 放到消息队列。</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="6" id="hyz7HmWcOTZ" class="whole-row"><tbody><tr class="outline-row level-6"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 57px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">先删除缓存，再更新数据库</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="7" id="hJaYdpmFfLS" class="whole-row note-expanded"><tbody><tr class="outline-row level-7"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 73px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 4px; padding-top: 4px; "><div class="force-wrap white-space">并发场景</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="7" id="nhJaYdpmFfLS" class="whole-note"><tbody><tr class="note-row level-7"><td><div class="note-outline-column-div force-wrap fill-cell"><table class="note-table"><tbody><tr><td style="width: 73px;" class="note-bg "> </td><td class="note-bg " style="width: 15px;"> </td><td class="note-bg label empty" style=" color: rgba(0,0,0,0); width: 1px; "></td><td class="note" style="padding-bottom: 5px; "><div class="force-wrap white-space">1. 线程A删除了缓存</div><div class="force-wrap white-space">2. 线程B查询，发现缓存已不存在</div><div class="force-wrap white-space">3. 线程B去数据库查询得到旧值</div><div class="force-wrap white-space">4. 线程B将旧值写入缓存</div><div class="force-wrap white-space">5. 线程A将新值写入数据库</div></td></tr></tbody></table></div></td></tr></tbody></table><table data-level="8" id="ipJwneUtI3I" class="whole-row"><tbody><tr class="outline-row level-8"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 89px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">方案：</div></td></tr></tbody></table></div></div></td></tr></tbody></table><table data-level="9" id="jm5-VtgWFpy" class="whole-row"><tbody><tr class="outline-row level-9"><td><div class="alt-row-layer fill-cell"><div class="fill-cell force-wrap"><table class="outline-column"><tbody><tr><td class="" style="width: 105px; "> </td><td class="handle " style="padding-top: 4px;  width: 15px; "><div class="handle"></div></td><td class="label empty" style="padding-top: 4px; width: 1px; "></td><td class="column" style="padding-bottom: 5px; padding-top: 4px; "><div class="force-wrap white-space">删除缓存、修改DB、读取缓存的操作入队列，实现串行化</div></td></tr></tbody></table></div></div></td></tr></tbody></table></div>
